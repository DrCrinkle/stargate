# appimage-builder recipe see https://appimage-builder.readthedocs.io for details
version: 1
script:
  - cd /stargate
  - rm -rf AppDir  | true
  - mkdir AppDir
  - cd /root/Python-3.10.8
  - './configure --enable-optimizations --prefix=/usr && DESTDIR=/stargate/AppDir make install'
  - cd /stargate
  - 'python3.10 -m pip install --ignore-installed --prefix=/usr --root=AppDir -r ./requirements.txt PyQt5 numpy'
  - make clean
  - make
  - DESTDIR=AppDir make install
  - sed -i 's!Icon=stargate!Icon=usr/share/pixmaps/stargate.png!g' AppDir/usr/share/applications/stargate.desktop
  - "mkdir -p AppDir/bin && cp /bin/sh AppDir/bin/sh"
  - cp /usr/bin/env AppDir/usr/bin/
AppDir:
  path: /stargate/AppDir
  app_info:
    id: com.github.stargatedaw.stargate
    name: StargateDAW
    icon: stargate
    version: {{VERSION}}
    exec: usr/bin/python3
    exec_args: "$APPDIR/usr/bin/stargate $@"
  apt:
    arch: ['amd64']
    allow_unauthenticated: true
    sources:
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic main restricted
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic universe
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic-updates universe
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic multiverse
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic-updates multiverse
    - sourceline: deb http://archive.ubuntu.com/ubuntu/ bionic-backports main restricted
        universe multiverse
    - sourceline: deb http://security.ubuntu.com/ubuntu/ bionic-security main restricted
    - sourceline: deb http://security.ubuntu.com/ubuntu/ bionic-security universe
    - sourceline: deb http://security.ubuntu.com/ubuntu/ bionic-security multiverse
    include:
      - libffi6
      - libfftw3-3
      - libportmidi0
      - libsndfile1
      - libportaudio2
      - rubberband-cli
  runtime:
    env:
      PYTHONHOME: '${APPDIR}/usr/lib/python3.10'
      PYTHONPATH: '${APPDIR}/usr/lib/python3.10:${APPDIR}/usr/lib/python3.10/site-packages:${APPDIR}/usr/lib/python3.10/lib-dynload'
  files:
    include: []
    exclude:
    - usr/share/man
    - usr/share/doc/*/README.*
    - usr/share/doc/*/changelog.*
    - usr/share/doc/*/NEWS.*
    - usr/share/doc/*/TODO.*
AppImage:
  arch: x86_64
  update-information: guess
